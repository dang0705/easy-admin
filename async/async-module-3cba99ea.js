import{m as F,$ as V,u as I,a as U,A as q}from"../main/index-53e1320b.js";import{u as G,D as H,a as J,R as Q}from"./async-module-ace7436d.js";import{n as L,_ as N}from"./async-module-fe7030e2.js";import{g as O,u as W}from"./async-module-0fee9d5b.js";import{i as E,h as j,p as B,r as u,w as R,q as X,v as Y,n as Z}from"./async-module-39a35f42.js";import{u as ee}from"./async-module-08d0ebb5.js";import{s as te}from"./async-module-38047afd.js";import{y as ae,A as oe,B as ne,h as se,c as le,D as ie,i as re,E as ce}from"./async-module-a57722d3.js";import"./async-module-a356b00f.js";import"./async-module-f7ef348c.js";import"./async-module-d40ead01.js";import"./async-module-456a8791.js";import"./async-module-b04b7353.js";const ue={createBtnText:{type:String,default:""},type:{type:String,default:"table"},thead:{type:Array,default:()=>[]},tbody:{type:Array,default:()=>[]},sort:{type:Boolean,default:!1},selected:{type:Boolean,default:!1},rowActions:{type:[Array,Function],default:()=>[]},idKey:{type:String,default:"id"},useDetailDialog:{type:Boolean,default:!0},createFormConfig:{type:Object,default:()=>({})},dialogDetailFormConfig:{type:Array,default:()=>[]},itemClass:{type:[Function,String],default:()=>"v-tr"},...G()},de=i=>i==null?void 0:i.replace(/^\S/,t=>t.toUpperCase()),pe={__name:"Table-row-actions",props:{actionConfig:{type:[Array,Function],default:()=>[]},data:{type:Object,default:()=>({})},useDetailDialog:{type:Boolean,default:!1}},emits:["open-action-dialog"],setup(i,{emit:t}){const a=i,e=E("idField",null),s=E("module",null),l=E("refreshData",null),m=j(()=>F({data:a.actionConfig,params:[a.data,l]})),A=o=>o?"a":"span",d=o=>F({data:o,params:[a.data]}),f=({body:o,id:r,showName:c,nameField:y,dataIdField:h,operate:v="删除",confirmByOperate:w,otherMessage:b})=>({msg:{body:o,name:c&&a.data[y]||"",id:r?F({data:r,params:[a.data]}):a.data[h],operate:v,confirmByOperate:w,otherMessage:b}}),g={async handleAction({cb:o=null,action:r=null,params:c}){await V.post(O(s,r),c),o&&o()},async handleEdit(o){t("open-action-dialog",{type:"detail",data:a.data,action:o})},async handleDelete(o){const{paramsIdField:r=e,dataIdField:c=e,multiple:y=!1,model:h="",operate:v="删除",params:w={}}=o,{useConfirm:b}=await N(()=>import("../main/index-53e1320b.js").then(C=>C.c),["main/index-53e1320b.js","async/async-module-39a35f42.js","async/async-module-fe7030e2.js","async/async-module-08d0ebb5.js","async/async-module-a57722d3.js","css/vuetify-ab536cbd.css","async/async-module-38047afd.js","async/async-module-b04b7353.js","async/async-module-a356b00f.js","async/async-module-f7ef348c.js","async/async-module-d40ead01.js","async/async-module-456a8791.js","css/index-7fd0b5da.css"]);await b({...f(o),async onConfirm(){await H(h||s,Object.assign({},F({data:w}),{[r]:y?[a.data[c]]:a.data[c]})),l&&l()},toast:{msg:`${v}成功`,shaped:!0}})},async handleConfirm(o){const{useConfirm:r}=await N(()=>import("../main/index-53e1320b.js").then(c=>c.c),["main/index-53e1320b.js","async/async-module-39a35f42.js","async/async-module-fe7030e2.js","async/async-module-08d0ebb5.js","async/async-module-a57722d3.js","css/vuetify-ab536cbd.css","async/async-module-38047afd.js","async/async-module-b04b7353.js","async/async-module-a356b00f.js","async/async-module-f7ef348c.js","async/async-module-d40ead01.js","async/async-module-456a8791.js","css/index-7fd0b5da.css"]);await r({...f(o),async onConfirm(){await V.post(O(o.module||s,o),o.params),l&&l()},toast:{msg:`${o.msg.operate||"操作"}成功`,shaped:!0}})},async handleDialog(o){I.emit("open-action-dialog",{type:"action",action:o,data:a.data})}};return{__sfc:!0,idField:e,module:s,refreshData:l,props:a,actions:m,isTagA:A,actionText:d,confirmMsg:f,emit:t,methods:g,rowActions:({type:o,action:r})=>g[`handle${de(o)}`](r)}}};var me=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a("div",{staticClass:"table-row-actions tw-flex tw-items-center"},[t._l(e.actions,function({show:s,text:l,target:m,type:A,url:d},f){return[!s||s(t.data)?a(e.isTagA(d),t._b({key:l,tag:"component",class:["tw-text-primary","tw-cursor-pointer","hover:tw-underline",{"tw-ml-2":f}],domProps:{textContent:t._s(e.actionText(l))},on:{click:function(g){e.isTagA(d)==="a"||e.rowActions({type:A,action:e.actions[f]})}}},"component",e.isTagA(d)==="a"?{href:d,target:m||"_blank",rel:"noopener"}:{},!1)):t._e()]})],2)},fe=[],_e=L(pe,me,fe,!1,null,null,null,null);const ge=_e.exports;function ve(i,t=50){let a=null;return(...e)=>{a&&clearTimeout(a),a=setTimeout(i.bind(this),t,e)}}const we={value:-1,text:"全部"};function ye(i,t=!0){const a=[];for(let e in i)a.push({value:+e,text:i[e]});return[...t?[we]:[],...a]}const he={__name:"Table-view",props:ue,emits:["input","selected"],setup(i,{emit:t}){const a=i,{mobile:e}=W(),s=J(a);B("module",s.value),B("idField",a.idKey);const{currentModule:l,currentMenuName:m,modules:A,options:{value:{[s.value]:d={}}={}}={}}=te(U());a.thead.forEach(n=>n.fixed&&(n.cellClass=n.class="td-fixed"));const f=u([]);a.formConfig.forEach(n=>f.value.push(d.hasOwnProperty(n.key)&&!n.options?{...n,options:ye(d[n.key])}:n));const g=10,T=u({}),o=u(!1),r=u(0),c=u(1),y=u([]),h=j(()=>Math.ceil(r.value/g)),v=u([]);let w=u(!1);const b=([{target:{scrollingElement:{offsetHeight:n,scrollTop:p,scrollHeight:_}}}])=>w.value=n+p+2>=_,C=n=>ve(b,100)(n),x=async()=>{o.value=!0;try{const{topbarActions:n=[],list:p=[],total:_}=await Q(s.value,{...T.value,page:c.value,size:g});y.value=n,r.value=_,v.value=e?v.value.concat(p):p}catch(n){}finally{await Z(),o.value=!1}};B("refreshData",x),R(()=>ee().name,n=>console.log(n)),R(()=>c.value,x),R(()=>w.value,n=>n&&c.value<h.value&&c.value++);const M=u(null),P=u(null);let k=u(null),$=u({}),S=u(!1);I.on("open-action-dialog",({type:n,action:p,data:_})=>{k.value=!0;const D=n==="detail";S.value=D,$.value={...p,...D?{title:`编辑${m.value}`}:{},data:_}});const K=()=>{var n;if(a.useDetailDialog){const{ele:p}=((n=M.value)==null?void 0:n.actions.find(({type:D})=>D==="detail"))||{},_=p||a.dialogDetailFormConfig;$.value={ele:_,title:`创建${m.value}`,data:P.value.initFormDataByConfig(_)},k.value=S.value=!0;return}$router.push({name:`${s.value}.detail`})},z=n=>t("input",n.map(({[a.idKey]:p})=>p));return X(()=>{e&&window.addEventListener("scroll",C),x()}),Y(()=>e&&window.removeEventListener("scroll",C)),{__sfc:!0,mobile:e,props:a,moduleName:s,currentModule:l,currentMenuName:m,modules:A,currentModuleStatus:d,emits:t,mergedSearchFormConfig:f,size:g,searchForm:T,loading:o,total:r,page:c,topBarActions:y,pages:h,list:v,mobile2Bottom:w,scroll:b,onScrColl:C,getData:x,tableRowActionsComp:M,formView:P,showDialog:k,dialogAction:$,feedback:S,onCreate:K,onSelect:z,ActionDialog:q,TableRowActions:ge}}};var be=function(){var t=this,a=t._self._c,e=t._self._setupProxy;return a(ae,{staticClass:"list-view elevation-4 rounded-lg tw-w-full",attrs:{"fixed-header":"","calculate-widths":"","hide-default-footer":"","checkbox-color":"primary","hide-default-header":!e.loading&&!e.list.length,headers:t.thead,items:e.list,"disable-sort":!t.sort,"show-select":t.selected,"item-key":t.idKey,loading:e.loading,"item-class":t.itemClass,page:e.page,"server-items-length":e.total},on:{input:e.onSelect},scopedSlots:t._u([{key:"top",fn:function(){var s;return[a(oe,{attrs:{flat:"",height:"extended"}},[a(ne,{staticClass:"tw-w-full tw-flex-col tw-items-start tw-px-4"},[e.mergedSearchFormConfig.length?a("Form-view",{ref:"formView",staticClass:"tw-mb-6 tw-w-full tw-pt-2",attrs:{"form-config":e.mergedSearchFormConfig,"use-grid":""},on:{reset:e.getData},model:{value:e.searchForm,callback:function(l){e.searchForm=l},expression:"searchForm"}}):t._e(),(s=e.modules[e.moduleName])!=null&&s.apis.create?a(se,{staticClass:"tw-mt-6 tw-h-8 tw-rounded-3xl tw-px-6 tw-py-2",attrs:{elevation:"2",color:"primary","min-width":"100"},on:{click:e.onCreate}},[a(le,[t._v(" mdi-plus")]),t._v(" "+t._s(t.createBtnText||`创建${e.currentMenuName}`)+" ")],1):t._e(),t._l(e.topBarActions,function(l){})],2),a(ie),e.showDialog!==null?a(e.ActionDialog,t._b({attrs:{feedback:e.feedback},model:{value:e.showDialog,callback:function(l){e.showDialog=l},expression:"showDialog"}},"Action-dialog",e.dialogAction,!1)):t._e()],1)]},proxy:!0},t._l(t.$scopedSlots,function(s,l){return{key:l,fn:function(m){return[t._t(l,null,null,m)]}}}),{key:"item.actions",fn:function({item:s}){return[a(e.TableRowActions,{ref:"tableRowActionsComp",attrs:{"action-config":t.rowActions,model:e.moduleName,data:s,"refresh-data":e.getData}})]}},{key:"footer",fn:function(){return[e.mobile?a("div",{staticClass:"tw-flex tw-justify-center"},[a(re,{directives:[{name:"show",rawName:"v-show",value:e.mobile2Bottom&&e.loading,expression:"mobile2Bottom && loading"}],attrs:{indeterminate:"",bottom:"",color:"primary"}}),e.pages&&e.page===e.pages&&!e.loading?a("p",{staticClass:"tw-text-sm tw-text-gray-500"},[t._v(" 没有更多了哦 ")]):t._e()],1):e.pages>1?a(ce,{attrs:{length:e.pages},model:{value:e.page,callback:function(s){e.page=s},expression:"page"}}):t._e()]},proxy:!0}],null,!0)})},Ae=[],Ce=L(he,be,Ae,!1,null,"3213c2c4",null,null);const Ne=Ce.exports;export{Ne as default};
