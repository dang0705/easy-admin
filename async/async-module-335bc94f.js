import{m as T}from"./async-module-6ebdee79.js";import{h as k,m as V,u as P,$ as A}from"../main/index-93f0b128.js";import{h as m,n as b,i as x,p as B,r as h,w as R,k as I}from"./async-module-39a35f42.js";import{n as S}from"./async-module-d331ac4b.js";import{F as H,c as G,G as M,H as N,J as E,d as L,g as q,h as w}from"./async-module-a57722d3.js";import{a as z,g as W}from"./async-module-9b51b733.js";import{u as U,b as J,C as K,U as Q}from"./async-module-2f5f9ef4.js";import{a as X}from"./async-module-08d0ebb5.js";import"./async-module-38047afd.js";import"./async-module-b04b7353.js";import"./async-module-a356b00f.js";import"./async-module-f7ef348c.js";import"./async-module-d40ead01.js";import"./async-module-456a8791.js";const Y={formControlVariant:["filled","outlined","solo"],control:{label:["tw-text-lg","tw-font-bold","tw-text-primary"]}},Z=()=>({formConfig:{type:Array,default:()=>[]},config:{type:Object,default:()=>({})},formData:{type:Object,default:()=>({})},dataSource:{type:Object,default:()=>({})},modelValue:{type:[String,Array,Object,Number,Boolean],default:null},refs:{type:Object,default:()=>({})}}),ee=(o,e)=>m(()=>V({data:o,params:[e]})),O=(o,e)=>m(()=>{var n;let t={};if(o.config.useRef){const{form:{$children:s=[]}={},...r}=e.$refs,a={};for(let l in r)a[l]=r[l][0];t=s.reduce((l,{getRefs:c})=>Object.assign({},l,c,e.$refs,a),((n=s.find(({getRefs:l}={})=>l))==null?void 0:n.getRefs)||{})}return t}),te=(o,{config:e,formData:t,formConfig:n},s={})=>e.change&&k.isFunction(e.change)&&e.change({config:e,formConfig:n,value:o,formData:t,refs:s}),ne=({props:o,emit:e,formView:t=null})=>m({get(){var c,_;const{modelValue:n,config:{key:s,value:r},formData:a}=o;if(n===null&&!Object.keys(a).length)return;const l=(_=n!=null?n:(c=a[s])==null?void 0:c.value)!=null?_:a[s];return k.isFunction(l)?l(a):l!=null?l:ee(r,a).value},async set(n){e("change",n),await b(),te(n,o,O(o,t).value)}}),se=()=>({model:{prop:"modelValue",event:"change"}}),oe=({config:o})=>({id:o.key+"-"+o.control});const ae={inheritAttrs:!1,...se(),data(){var o;return{isShow:(o=this.config.show)!=null?o:!0}},computed:{getRefs(){return this.$refs},show:{get(){const{formView:o,props:e}=this._setupProxy;return V({data:this.isShow,params:[e.formData,O(e,o).value]})},set(o){this.isShow=o,!o&&this.resetValueWhenHide()}}},watch:{show(o){!o&&this.resetValueWhenHide()}},methods:{resetValueWhenHide(){const{value:o,defaultValue:e}=this._setupProxy;o!==e&&this.$emit("change",e)}}},le=Object.assign(ae,{__name:"ui-input",props:Z(),emits:["change"],setup(o,{emit:e}){const t=o,n=x("formView",null),s=x("formConfig",null),r=ne({props:t,emit:e,formView:n});return{__sfc:!0,formView:n,formConfig:s,props:t,emit:e,value:r,themes:Y,mdiAsterisk:T,useId:oe}}});var re=function(){var e=this,t=e._self._c,n=e._self._setupProxy;return t(H,e._b({directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],attrs:{"hide-details":""},scopedSlots:e._u([{key:"prepend",fn:function(){return[t(G,{staticStyle:{width:"16px"},attrs:{small:"",color:"red"},domProps:{textContent:e._s(e.config.required?n.mdiAsterisk:"")}})]},proxy:!0},{key:"label",fn:function(){return[e.config.label?t("span",{class:[...n.themes.control.label,"tw-select-none"],domProps:{textContent:e._s(`${e.config.label}：`)}}):e._e()]},proxy:!0}])},"v-input",n.useId(n.props),!1),[t("div",{staticClass:"tw-flex tw-w-full tw-flex-col tw-pt-4"},[e._t(`on-${e.config.key}`),t(e.config.control,e._g({ref:e.config.useRef?`${e.config.key}-${e.config.control}`:null,tag:"component",attrs:{show:e.show,config:e.config,"form-config":n.formConfig,"form-data":e.formData,"data-source":e.formData},scopedSlots:e._u([e._l(e.$scopedSlots,function(s,r){return{key:r,fn:function(){return[e._t(r)]},proxy:!0}})],null,!0),model:{value:e.formData[e.config.key],callback:function(s){e.$set(e.formData,e.config.key,s)},expression:"formData[config.key]"}},e.$listeners)),e._t(`under-${e.config.key}`)],2)])},ie=[],ue=S(le,re,ie,!1,null,"c208b728",null,null);const ce=ue.exports,fe={class:"tw-mx-2 tw-h-8 tw-px-6 tw-py-2",elevation:"2",rounded:!0,color:"primary"},pe=I({model:{prop:"value",event:"change"}}),me=Object.assign(pe,{__name:"Form-view",props:{actionApi:{type:String,default:""},action:{type:String,default:""},value:{type:Object,default:()=>({})},type:{type:String,default:"horizontal"},nowrap:{type:Boolean,default:!1},attrs:{type:Object,default:()=>({})},useGrid:{type:Boolean,default:!1},isNew:{type:Boolean,default:!0},inDialog:{type:Boolean,default:!1},paginationOptions:{type:[Object,Function],default:null},submitText:{type:String,default:"保存"},prevText:{type:String,default:"上一步"},nextText:{type:String,default:"下一步"},...U()},emits:["change","close-dialog","search"],setup(o,{emit:e}){const t=o,n=X(),s=z();B("formView",s);const r=x("formConfig",null)||J(t.formConfig),a=h([...r]),l=h(""),c=h(!0),_=m(()=>a.value.some(({rules:u,required:p})=>u&&u.length||p)),i=m(()=>k.isArray(r[0])),d=i.value?m(()=>f.value===r.length-1):null,f=i.value?h(0):null;i.value&&R(()=>f.value,u=>a.value=[...r[u]],{immediate:!0});const C=()=>f.value?f.value--:n.back(),j=async()=>{var v,y,$;if(_.value&&l.value.validate(),await b(),!c.value)return;const u={...t.value,...t.extraRequestParams,...i.value?{[((v=t.paginationOptions)==null?void 0:v.pageField)||"page"]:f.value+1,...d.value?{submit:!0}:{}}:{}},p=async()=>{t.actionApi||t.action?await A.post(t.actionApi||W(t.module,t.action),u):await(t.isNew?K:Q)(t.module,u),!i.value||i.value&&d.value&&P.emit("toast",{msg:"操作成功",shaped:!0})};i.value&&((y=t.paginationOptions)!=null&&y.save)||!i.value?(await p(),!i.value&&n.back()):i.value&&(($=t.paginationOptions)!=null&&$.confirm)&&d.value&&P.emit("confirm",{msg:`是否${t.submitText}？`,toast:!0,onConfirm:async()=>{await p(),n.back()}}),await b(),i.value&&!d.value&&f.value++},D=()=>{if(i.value){C();return}g(),t.inDialog?e("close-dialog"):n.back()},F=()=>{l.value.resetValidation(),g(),e("reset")},g=async(u=a.value)=>{const p={};u.forEach(({key:v,value:y=null})=>v&&(p[v]=y)),e("change",p)};return t.isNew&&g(a.value),{__sfc:!0,$router:n,props:t,emit:e,formView:s,formConfig:r,formConfigCache:a,form:l,valid:c,useValidations:_,pagination:i,isLastPage:d,page:f,prev:C,submit:j,cancel:D,onreset:F,initFormDataByConfig:g,uiInput:ce,actionVBtnProps:fe}}});var _e=function(){var e=this,t=e._self._c,n=e._self._setupProxy;return t(M,{ref:"form",staticClass:"form-view tw-flex-grow tw-flex tw-flex-col tw-items-start",attrs:{"lazy-validation":""},model:{value:n.valid,callback:function(s){n.valid=s},expression:"valid"}},[e._t("before-controls"),t("div",{staticClass:"tw-flex-grow tw-w-full"},[t(N,{staticClass:"tw-flex-grow-0"},e._l(n.formConfigCache,function(s,r){return t(E,{key:s.key,attrs:{cols:e.useGrid?4:12}},[!e.useGrid&&(s.title||s.subTitle)?t("div",{style:s.titleStyle},[t("h3",{domProps:{innerHTML:e._s(s.title)}}),t("section",{domProps:{innerHTML:e._s(s.subTitle)}}),t(L,{staticClass:"tw-my-4"})],1):e._e(),t(n.uiInput,{ref:s.key?`${s.key}-input`:null,refInFor:!0,staticClass:"ui-input",attrs:{config:s,"form-configs":n.formConfigCache,"form-data":e.value},on:{"control-is-show":function(a){s.show=a}},scopedSlots:e._u([e._l(e.$scopedSlots,function(a,l){return{key:l,fn:function(){return[e._t(l)]},proxy:!0}})],null,!0),model:{value:e.value[s.key],callback:function(a){e.$set(e.value,s.key,a)},expression:"value[configuration.key]"}})],1)}),1)],1),e._t("after-controls"),e._t("actions",function(){return[t(q,{staticClass:"tw-mb-4 tw-flex tw-w-full tw-justify-center"},[e.useGrid?[t(w,e._b({on:{click:function(s){return e.$emit("search")}}},"v-btn",n.actionVBtnProps,!1),[e._v(" 查询 ")]),t(w,e._b({attrs:{plain:""},on:{click:n.onreset}},"v-btn",n.actionVBtnProps,!1),[e._v(" 重置 ")])]:[t(w,e._b({on:{click:n.submit}},"v-btn",n.actionVBtnProps,!1),[e._v(" "+e._s(n.pagination&&!n.isLastPage?e.nextText:e.submitText)+" ")]),t(w,e._b({attrs:{plain:""},domProps:{textContent:e._s(n.pagination&&n.page?e.prevText:e.inDialog?"取消":"返回")},on:{click:n.cancel}},"v-btn",n.actionVBtnProps,!1))]],2)]})],2)},de=[],ve=S(me,_e,de,!1,null,null,null,null);const De=ve.exports;export{De as default};
